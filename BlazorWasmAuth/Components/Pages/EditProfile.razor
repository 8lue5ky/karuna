@page "/edit"

@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor
@inject ISnackbar Snackbar
@inject IHttpClientFactory HttpClientFactory

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
<MudPaper Class="pa-6 max-w-lg mx-auto my-6 rounded-lg" Outlined="true">
    <MudStack Spacing="3">

        <MudText Typo="Typo.h5" Class="font-semibold mb-2">👤 Edit profile</MudText>

        <MudForm @ref="_form" Model="_profile">
            <MudStack Spacing="2">

                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
	                <MudAvatar Size="Size.Large" Class="shadow-md">
                        <MudImage Src="@_profilePicturePreview"></MudImage>
	                </MudAvatar>
                    <div class="d-flex flex-column">
                        <div class="d-flex gap-2">
                            <MudButton Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Upload" OnClick="@OpenFilePicker">
                                Change profile picture
                            </MudButton>
                            <MudButton Variant="Variant.Text" OnClick="@ClearSelectedImage">Delete</MudButton>
                        </div>
                        <MudText Typo="Typo.caption" Class="mt-1">PNG/JPG, max. 2 MB</MudText>
                        <MudFileUpload @ref="_fileUpload"
                                       T="IBrowserFile"
                                       Accept=".png,.jpg,.jpeg"
                                       MaxFileSize="2097152"
                                       FilesChanged="OnFileChanged"
                                       Class="d-none" />
                    </div>
                </MudStack>

                <MudTextField Label="Username"
                              For="@(() => _profile.Username)"
                              @bind-Value="_profile.Username"
                              Required="true"
                              RequiredError="Username is required" />

                <MudTextField Label="Email address"
                              For="@(() => _profile.Email)"
                              @bind-Value="_profile.Email"
                              InputType="InputType.Email"
                              Required="true"
                              RequiredError="E-Mail is required" />

                <MudTextField Label="About me"
                              For="@(() => _profile.Bio)"
                              @bind-Value="_profile.Bio"
                              Lines="3"
                              MaxLength="300"
                              HelperText="Max. 300 characters" />

                <MudTextField Label="Location"
                              For="@(() => _profile.Location)"
                              @bind-Value="_profile.Location" />

                <MudStack Row="true" Justify="Justify.FlexEnd" Spacing="2" Class="mt-3">
                    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="OnCancelClicked">Cancel</MudButton>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="OnSaveClicked">Save</MudButton>
                </MudStack>
            </MudStack>
        </MudForm>
    </MudStack>
</MudPaper>

</MudContainer>
